package ru.ifmo.onell.algorithm

import org.scalatest.flatspec.AnyFlatSpec
import org.scalatest.matchers.should.Matchers

import ru.ifmo.onell.algorithm.OnePlusLambdaLambdaGA.defaultOneFifthLambda
import ru.ifmo.onell.main.util.AlgorithmCodeNames
import ru.ifmo.onell.problem.OneMax

class OnePlusLambdaLambdaGAConfigurationTests extends AnyFlatSpec with Matchers {
  private val ProblemSize = 1 << 16   // 1<<15 yields a number of "false" negatives, 1<<17 takes too much time

  private def validate(name: String, lowerBound: Double, upperBound: Double): Unit =
    s"Configuration $name in notation of Anton Bassin" should "be within limits" in {
      val parsedSequence = AlgorithmCodeNames.parseOnePlusLambdaLambdaGenerators(name)
      parsedSequence.size shouldBe 1
      val algorithm = parsedSequence.head._1.apply(defaultOneFifthLambda)
      val result = algorithm.optimize(new OneMax(ProblemSize)).toDouble / ProblemSize
      result should (be >= lowerBound)
      result should (be <= upperBound)
    }

  validate("SSLID", 10.467735290527344, 11.362144470214844)
  validate("SSLIU", 10.547080993652344, 11.736961364746094)
  validate("SSLIP", 10.595157623291016, 11.516101837158203)
  validate("SSLSD", 9.31888198852539, 10.128223419189453)
  validate("SSLSU", 9.845176696777344, 10.767753601074219)
  validate("SSLSP", 9.601367950439453, 10.294376373291016)
  validate("SSLMD", 9.125221252441406, 10.416236877441406)
  validate("SSLMU", 9.735786437988281, 10.377998352050781)
  validate("SSLMP", 9.459579467773438, 10.475997924804688)
  validate("SSLCD", 9.031608581542969, 9.886039733886719)
  validate("SSLCU", 9.164066314697266, 10.073993682861328)
  validate("SSLCP", 9.07781982421875, 9.9163818359375)
  validate("SSDID", 10.014320373535156, 10.981178283691406)
  validate("SSDIU", 10.421607971191406, 11.192848205566406)
  validate("SSDIP", 10.280487060546875, 10.965911865234375)
  validate("SSDSD", 9.103252410888672, 9.802974700927734)
  validate("SSDSU", 9.367767333984375, 10.275482177734375)
  validate("SSDSP", 9.05893325805664, 10.417560577392578)
  validate("SSDMD", 8.412403106689453, 9.920108795166016)
  validate("SSDMU", 8.755661010742188, 9.607040405273438)
  validate("SSDMP", 8.415847778320312, 9.674942016601562)
  validate("SSDCD", 8.633419036865234, 9.300182342529297)
  validate("SSDCU", 8.671119689941406, 9.701637268066406)
  validate("SSDCP", 8.661148071289062, 9.651138305664062)
  validate("SHLID", 7.785118103027344, 8.138694763183594)
  validate("SHLIU", 8.331901550292969, 8.744285583496094)
  validate("SHLIP", 7.9800567626953125, 8.435317993164062)
  validate("SHLSD", 7.192493438720703, 7.524021148681641)
  validate("SHLSU", 7.6850433349609375, 8.216537475585938)
  validate("SHLSP", 7.427845001220703, 7.846286773681641)
  validate("SHLMD", 6.530887603759766, 6.930774688720703)
  validate("SHLMU", 6.781864166259766, 7.158496856689453)
  validate("SHLMP", 6.597888946533203, 7.012851715087891)
  validate("SHLCD", 6.509223937988281, 6.912208557128906)
  validate("SHLCU", 6.762847900390625, 7.16748046875)
  validate("SHLCP", 6.665782928466797, 6.988033294677734)
  validate("SHDID", 7.527919769287109, 7.890209197998047)
  validate("SHDIU", 7.892444610595703, 8.33823013305664)
  validate("SHDIP", 7.718681335449219, 8.101615905761719)
  validate("SHDSD", 6.822536468505859, 7.339305877685547)
  validate("SHDSU", 7.180511474609375, 7.5037841796875)
  validate("SHDSP", 6.972175598144531, 7.438148498535156)
  validate("SHDMD", 6.299446105957031, 6.640907287597656)
  validate("SHDMU", 6.458930969238281, 6.959571838378906)
  validate("SHDMP", 6.3978424072265625, 6.7339935302734375)
  validate("SHDCD", 6.307033538818359, 6.663219451904297)
  validate("SHDCU", 6.445011138916016, 6.833484649658203)
  validate("SHDCP", 6.398944854736328, 6.761234283447266)
  validate("SRLID", 8.104049682617188, 8.585525512695312)
  validate("SRLIU", 8.713542938232422, 9.034481048583984)
  validate("SRLIP", 8.330020904541016, 8.849658966064453)
  validate("SRLSD", 7.4925994873046875, 8.059066772460938)
  validate("SRLSU", 8.120559692382812, 8.489364624023438)
  validate("SRLSP", 7.849617004394531, 8.193122863769531)
  validate("SRLMD", 6.905036926269531, 7.294837951660156)
  validate("SRLMU", 7.051563262939453, 7.532688140869141)
  validate("SRLMP", 6.911487579345703, 7.451236724853516)
  validate("SRLCD", 6.826869964599609, 7.303356170654297)
  validate("SRLCU", 7.054721832275391, 7.515369415283203)
  validate("SRLCP", 6.954170227050781, 7.371833801269531)
  validate("SRDID", 7.9019012451171875, 8.348678588867188)
  validate("SRDIU", 8.268585205078125, 8.718902587890625)
  validate("SRDIP", 8.10400390625, 8.51629638671875)
  validate("SRDSD", 7.336284637451172, 7.742061614990234)
  validate("SRDSU", 7.528606414794922, 7.977657318115234)
  validate("SRDSP", 7.454456329345703, 7.900547027587891)
  validate("SRDMD", 6.656452178955078, 7.256443023681641)
  validate("SRDMU", 6.801445007324219, 7.196739196777344)
  validate("SRDMP", 6.7311248779296875, 7.2598114013671875)
  validate("SRDCD", 6.713134765625, 7.07513427734375)
  validate("SRDCU", 6.8004608154296875, 7.2960662841796875)
  validate("SRDCP", 6.761211395263672, 7.146602630615234)
  validate("HSLID", 9.834495544433594, 10.673851013183594)
  validate("HSLIU", 9.358039855957031, 10.416572570800781)
  validate("HSLIP", 9.651325225830078, 10.42941665649414)
  validate("HSLSD", 8.524978637695312, 9.922012329101562)
  validate("HSLSU", 8.49346923828125, 9.484130859375)
  validate("HSLSP", 8.653938293457031, 9.479652404785156)
  validate("HSLMD", 8.512989044189453, 9.405765533447266)
  validate("HSLMU", 8.291400909423828, 9.34268569946289)
  validate("HSLMP", 8.367294311523438, 9.410049438476562)
  validate("HSLCD", 8.121299743652344, 8.977378845214844)
  validate("HSLCU", 7.754417419433594, 8.641532897949219)
  validate("HSLCP", 7.8816070556640625, 9.019699096679688)
  validate("HSDID", 9.168174743652344, 9.998497009277344)
  validate("HSDIU", 9.023391723632812, 9.873092651367188)
  validate("HSDIP", 9.12485122680664, 10.187702178955078)
  validate("HSDSD", 8.30777359008789, 9.270862579345703)
  validate("HSDSU", 7.977569580078125, 9.21197509765625)
  validate("HSDSP", 8.320907592773438, 9.082565307617188)
  validate("HSDMD", 7.605205535888672, 8.47195053100586)
  validate("HSDMU", 7.208858489990234, 8.017742156982422)
  validate("HSDMP", 7.470348358154297, 8.27053451538086)
  validate("HSDCD", 7.454868316650391, 8.915790557861328)
  validate("HSDCU", 7.226184844970703, 8.031925201416016)
  validate("HSDCP", 7.469058990478516, 8.242633819580078)
  validate("HHLID", 7.386161804199219, 7.788261413574219)
  validate("HHLIU", 7.839195251464844, 8.273704528808594)
  validate("HHLIP", 7.57415771484375, 7.989105224609375)
  validate("HHLSD", 6.8639373779296875, 7.2960662841796875)
  validate("HHLSU", 7.1891326904296875, 7.5869293212890625)
  validate("HHLSP", 7.084506988525391, 7.389362335205078)
  validate("HHLMD", 5.9881439208984375, 6.4086456298828125)
  validate("HHLMU", 5.935268402099609, 6.309520721435547)
  validate("HHLMP", 6.017906188964844, 6.326438903808594)
  validate("HHLCD", 5.915225982666016, 6.379230499267578)
  validate("HHLCU", 5.879085540771484, 6.339488983154297)
  validate("HHLCP", 5.986297607421875, 6.331939697265625)
  validate("HHDID", 7.142799377441406, 7.524330139160156)
  validate("HHDIU", 7.363067626953125, 7.80792236328125)
  validate("HHDIP", 7.266178131103516, 7.679187774658203)
  validate("HHDSD", 6.542655944824219, 6.907524108886719)
  validate("HHDSU", 6.664886474609375, 7.03021240234375)
  validate("HHDSP", 6.630702972412109, 7.066844940185547)
  validate("HHDMD", 5.812187194824219, 6.135368347167969)
  validate("HHDMU", 5.670085906982422, 6.051753997802734)
  validate("HHDMP", 5.737216949462891, 6.182086944580078)
  validate("HHDCD", 5.794914245605469, 6.175621032714844)
  validate("HHDCU", 5.658138275146484, 6.054821014404297)
  validate("HHDCP", 5.773601531982422, 6.078121185302734)
  validate("HRLID", 7.77679443359375, 8.239166259765625)
  validate("HRLIU", 8.125846862792969, 8.614128112792969)
  validate("HRLIP", 7.815101623535156, 8.633613586425781)
  validate("HRLSD", 7.276424407958984, 7.699871063232422)
  validate("HRLSU", 7.508792877197266, 7.974658966064453)
  validate("HRLSP", 7.412315368652344, 7.905632019042969)
  validate("HRLMD", 6.353702545166016, 6.730945587158203)
  validate("HRLMU", 6.175167083740234, 6.656169891357422)
  validate("HRLMP", 6.245967864990234, 6.867687225341797)
  validate("HRLCD", 6.298748016357422, 6.778469085693359)
  validate("HRLCU", 6.152606964111328, 6.678531646728516)
  validate("HRLCP", 6.290855407714844, 6.727470397949219)
  validate("HRDID", 7.581001281738281, 7.979255676269531)
  validate("HRDIU", 7.731452941894531, 8.133247375488281)
  validate("HRDIP", 7.637416839599609, 8.106639862060547)
  validate("HRDSD", 6.996875762939453, 7.402927398681641)
  validate("HRDSU", 6.995334625244141, 7.497150421142578)
  validate("HRDSP", 7.058616638183594, 7.479270935058594)
  validate("HRDMD", 6.189647674560547, 6.522396087646484)
  validate("HRDMU", 6.011936187744141, 6.370746612548828)
  validate("HRDMP", 5.983753204345703, 6.652286529541016)
  validate("HRDCD", 6.198780059814453, 6.601657867431641)
  validate("HRDCU", 5.97589111328125, 6.45013427734375)
  validate("HRDCP", 6.048126220703125, 6.555084228515625)
  validate("RSLID", 9.815803527832031, 10.554573059082031)
  validate("RSLIU", 9.472877502441406, 10.234596252441406)
  validate("RSLIP", 9.667499542236328, 10.47153091430664)
  validate("RSLSD", 8.70852279663086, 9.674022674560547)
  validate("RSLSU", 8.628910064697266, 9.575305938720703)
  validate("RSLSP", 8.691116333007812, 9.592483520507812)
  validate("RSLMD", 8.387397766113281, 9.967811584472656)
  validate("RSLMU", 8.297645568847656, 9.085487365722656)
  validate("RSLMP", 8.384857177734375, 9.4287109375)
  validate("RSLCD", 8.11505126953125, 9.046478271484375)
  validate("RSLCU", 7.795566558837891, 8.731739044189453)
  validate("RSLCP", 8.009170532226562, 8.945114135742188)
  validate("RSDID", 9.227645874023438, 10.164443969726562)
  validate("RSDIU", 9.077293395996094, 9.907310485839844)
  validate("RSDIP", 9.248313903808594, 10.178367614746094)
  validate("RSDSD", 8.27499008178711, 9.306102752685547)
  validate("RSDSU", 8.111557006835938, 9.111404418945312)
  validate("RSDSP", 8.248592376708984, 9.315288543701172)
  validate("RSDMD", 7.841762542724609, 8.539073944091797)
  validate("RSDMU", 7.325736999511719, 8.324851989746094)
  validate("RSDMP", 7.714225769042969, 8.464927673339844)
  validate("RSDCD", 7.6993255615234375, 8.816085815429688)
  validate("RSDCU", 7.437919616699219, 8.300590515136719)
  validate("RSDCP", 7.609344482421875, 8.4454345703125)
  validate("RHLID", 7.478599548339844, 7.825523376464844)
  validate("RHLIU", 7.927207946777344, 8.212974548339844)
  validate("RHLIP", 7.629489898681641, 8.039325714111328)
  validate("RHLSD", 6.94744873046875, 7.343902587890625)
  validate("RHLSU", 7.248161315917969, 7.754142761230469)
  validate("RHLSP", 7.162879943847656, 7.434700012207031)
  validate("RHLMD", 6.158687591552734, 6.523082733154297)
  validate("RHLMU", 6.093994140625, 6.4957275390625)
  validate("RHLMP", 6.117237091064453, 6.522983551025391)
  validate("RHLCD", 6.120563507080078, 6.571109771728516)
  validate("RHLCU", 6.065155029296875, 6.48480224609375)
  validate("RHLCP", 6.098964691162109, 6.500591278076172)
  validate("RHDID", 7.151130676269531, 7.536323547363281)
  validate("RHDIU", 7.2714996337890625, 7.6751556396484375)
  validate("RHDIP", 7.282756805419922, 7.598842620849609)
  validate("RHDSD", 6.543495178222656, 6.907081604003906)
  validate("RHDSU", 6.580829620361328, 6.925052642822266)
  validate("RHDSP", 6.640907287597656, 6.948402404785156)
  validate("RHDMD", 5.915199279785156, 6.270301818847656)
  validate("RHDMU", 5.811244964599609, 6.178295135498047)
  validate("RHDMP", 5.906436920166016, 6.228534698486328)
  validate("RHDCD", 5.907238006591797, 6.242183685302734)
  validate("RHDCU", 5.77203369140625, 6.17584228515625)
  validate("RHDCP", 5.8966064453125, 6.246856689453125)
  validate("RRLID", 7.870704650878906, 8.257728576660156)
  validate("RRLIU", 8.110572814941406, 8.647071838378906)
  validate("RRLIP", 7.94000244140625, 8.522247314453125)
  validate("RRLSD", 7.325023651123047, 7.734737396240234)
  validate("RRLSU", 7.551166534423828, 8.19650650024414)
  validate("RRLSP", 7.476581573486328, 7.932346343994141)
  validate("RRLMD", 6.476985931396484, 6.908885955810547)
  validate("RRLMU", 6.385829925537109, 6.839488983154297)
  validate("RRLMP", 6.410762786865234, 6.937938690185547)
  validate("RRLCD", 6.461265563964844, 6.929130554199219)
  validate("RRLCU", 6.3985137939453125, 6.7714996337890625)
  validate("RRLCP", 6.440471649169922, 6.869106292724609)
  validate("RRDID", 7.581993103027344, 8.053489685058594)
  validate("RRDIU", 7.533210754394531, 8.181831359863281)
  validate("RRDIP", 7.629344940185547, 8.12966537475586)
  validate("RRDSD", 7.02740478515625, 7.364898681640625)
  validate("RRDSU", 6.938453674316406, 7.437965393066406)
  validate("RRDSP", 7.055721282958984, 7.450023651123047)
  validate("RRDMD", 6.2463226318359375, 6.7074737548828125)
  validate("RRDMU", 6.1095123291015625, 6.5614471435546875)
  validate("RRDMP", 6.228298187255859, 6.611370086669922)
  validate("RRDCD", 6.3289337158203125, 6.6672210693359375)
  validate("RRDCU", 6.021488189697266, 6.630146026611328)
  validate("RRDCP", 6.238788604736328, 6.680515289306641)
}
